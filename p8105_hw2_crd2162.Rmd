---
title: "p8105_hw2_crd2162"
author: "Caleigh Dwyer"
date: "2023-09-26"
output: github_document
---

```{r load library}
library(tidyverse)
library(readxl)
```

## Problem 1: Cleaning and merging FiveThiryEight data

In the chunk below, we will clean the data in pols-month.csv. This data comes from 538 and provides information on the number of national politicians who are democratic or republican at any given time. 

There are some values for which `prez_gop` is `2` -- these are months in which Ford became President following Nixon's resignation. In the new `president` variable created as part of our data cleaning, we code these as `gop` (same as values when `prez_gop` is `1`).

```{r pols_cleaned}
month_df = 
  tibble(
    month_num = 1:12,
    month_abb = month.abb,
    month = month.name
  )

pols = 
  read_csv("data/pols-month.csv") |>
  separate(mon, into = c("year", "month_num", "day"), convert = TRUE) |>
  mutate(
    president = recode(prez_gop, "0" = "dem", "1" = "gop", "2" = "gop")) |>
  left_join(x = _, y = month_df) |> 
  select(year, month, everything(), -day, -starts_with("prez")) 
```


In the chunk below, we will clean the data in snp.csv from 538. This contains information related to Standard & Poorâ€™s stock market index.

```{r snp_cleaned}
snp = 
  read_csv("data/snp.csv") |>
  separate(date, into = c("month", "day", "year"), convert = TRUE) |>
  arrange(year, month) |>
  mutate(month = month.name[month]) |>
  select(year, month, close) 

view(snp)
```


In the chunk below, we tidy the `unemployment` data so that it can be merged with the `pols` and `snp` datasets.

```{r unemployment_cleaned}
unemployment = 
  read_csv("data/unemployment.csv") |>
  rename(year = Year) |>
  pivot_longer(
    Jan:Dec, 
    names_to = "month_abb",
    values_to = "unemployment"
  ) |> 
  left_join(x = _, y = month_df) |> 
  select(year, month, unemployment)
```

In the chunk below, we merge the three datasets.

```{r merge_538}

snp <- snp |>
  mutate(
    year_format = case_when(
      year > 15 ~ paste0("19", year),
      year >= 10 & year <= 15 ~ paste0("20", year),
      year < 10 ~ paste0("200", year),
      TRUE ~ as.character(year)  # Handle other cases
    )
  )

snp$year_format <- as.integer(snp$year_format)

data_538 = 
  left_join(pols, snp, by = c("year" = "year_format", "month" = "month")) |>
  left_join(x = _, y = unemployment, by = c("year", "month"))

str(data_538)
view(data_538)
```

